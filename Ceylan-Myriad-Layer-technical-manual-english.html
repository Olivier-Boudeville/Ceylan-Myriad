<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Welcome to the Ceylan-Myriad documentation</title>
<meta content="Myriad, generic, general-purpose, helper code, library, layer" name="keywords" />
<link rel="stylesheet" href="pygments-default.css" type="text/css" />
<link rel="stylesheet" href="myriad.css" type="text/css" />
<link href="myriad-icon.png" rel="icon">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="document">


<span class="target" id="top"></span><p><span class="raw-html"><a name="myriad_top"></a></span></p>
<p><span class="raw-html"><div class="banner"><p><em>Myriad documentation</em> <a href="http://myriad.esperide.org">browse latest</a> <a href="https://olivier-boudeville.github.io/Ceylan-Myriad/index.html">browse mirror</a> <a href="myriad.pdf">get PDF</a> <a href="#myriad_top">go to top</a> <a href="#myriad_bottom">go to bottom</a> <a href="mailto:about(dash)myriad(at)esperide(dot)com?subject=[Ceylan-Myriad]%20Remark">email us</a></p></div></span></p>
<p><span class="raw-html"><center><img src="myriad-title.png" width="70%"></img></center></span>
</p>
<div class="section" id="technical-manual-of-the-ceylan-myriad-layer">
<h1><a class="toc-backref" href="#id22">Technical Manual of the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> Layer</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Organisation:</th><td class="field-body"><p class="first">Copyright (C) 2008-2019 Olivier Boudeville</p>
</td>
</tr>
<tr class="field"><th class="field-name">Contact:</th><td class="field-body"><p class="first">about (dash) myriad (at) esperide (dot) com</p>
</td>
</tr>
<tr class="field"><th class="field-name">Creation date:</th><td class="field-body"><p class="first">Sunday, August 17, 2008</p>
</td>
</tr>
<tr class="field"><th class="field-name">Lastly updated:</th><td class="field-body"><p class="first">Sunday, March 17, 2019</p>
</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body"><p class="first">Stable</p>
</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body"><p class="first">1.2.6</p>
</td>
</tr>
<tr class="field"><th class="field-name">Dedication:</th><td class="field-body"><p class="first">Users and maintainers of the <tt class="docutils literal">Myriad</tt> layer.</p>
</td>
</tr>
<tr class="field"><th class="field-name">Abstract:</th><td class="field-body"><p class="first">The role of the <a class="reference external" href="http://myriad.esperide.org/">Myriad</a> layer (part of the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan">Ceylan</a> project) is to gather all <a class="reference external" href="http://erlang.org">Erlang</a> general-purpose base constructs that we found useful for (Erlang-based) developments.</p>
<p class="last">We present here a short overview of these services, to introduce them to newcomers.
The next level of information is to read the corresponding <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad">source files</a>, which are intensely commented and generally straightforward.</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#technical-manual-of-the-ceylan-myriad-layer" id="id22">Technical Manual of the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> Layer</a><ul>
<li><a class="reference internal" href="#overview-context" id="id23">Overview &amp; Context</a></li>
<li><a class="reference internal" href="#usage-guidelines" id="id24">Usage Guidelines</a><ul>
<li><a class="reference internal" href="#license" id="id25">License</a></li>
<li><a class="reference internal" href="#about-layers" id="id26">About Layers</a></li>
<li><a class="reference internal" href="#recommended-usage-contribution" id="id27">Recommended Usage &amp; Contribution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-myriad" id="id28">Getting Myriad</a><ul>
<li><a class="reference internal" href="#prerequisites" id="id29">Prerequisites</a></li>
<li><a class="reference internal" href="#getting-the-sources" id="id30">Getting the Sources</a></li>
<li><a class="reference internal" href="#building-myriad" id="id31">Building Myriad</a></li>
<li><a class="reference internal" href="#testing-myriad" id="id32">Testing Myriad</a></li>
<li><a class="reference internal" href="#type-checking-myriad" id="id33">Type-checking Myriad</a></li>
</ul>
</li>
<li><a class="reference internal" href="#services-offered-by-the-myriad-layer" id="id34">Services offered by the <tt class="docutils literal">Myriad</tt> Layer</a><ul>
<li><a class="reference internal" href="#general-build-structure" id="id35">General Build Structure</a></li>
<li><a class="reference internal" href="#general-settings" id="id36">General Settings</a></li>
<li><a class="reference internal" href="#maths-services" id="id37">Maths Services</a></li>
<li><a class="reference internal" href="#data-management-services" id="id38">Data-Management Services</a></li>
<li><a class="reference internal" href="#support-for-code-injection" id="id39">Support for Code Injection</a><ul>
<li><a class="reference internal" href="#defining-a-token" id="id40">Defining a token</a></li>
<li><a class="reference internal" href="#using-tokens-to-enable-code-injection" id="id41">Using tokens to enable code injection</a></li>
<li><a class="reference internal" href="#controlling-assertions" id="id42">Controlling assertions</a></li>
<li><a class="reference internal" href="#for-more-information" id="id43">For more information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#helpers-for-user-interface-programming" id="id44">Helpers For User Interface Programming</a><ul>
<li><a class="reference internal" href="#various-flavours-of-user-interfaces" id="id45">Various Flavours of User Interfaces</a></li>
<li><a class="reference internal" href="#raw-text-user-interface-text-ui" id="id46">Raw Text User Interface: <tt class="docutils literal">text_ui</tt></a></li>
<li><a class="reference internal" href="#terminal-text-user-interface-term-ui" id="id47">Terminal Text User Interface: <tt class="docutils literal">term_ui</tt></a></li>
<li><a class="reference internal" href="#graphical-user-interface-gui" id="id48">Graphical User Interface: <tt class="docutils literal">gui</tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#all-purpose-helper-scripts" id="id49">All-Purpose Helper Scripts</a></li>
<li><a class="reference internal" href="#utility-toolbox" id="id50">Utility Toolbox</a></li>
<li><a class="reference internal" href="#support-for-metaprogramming" id="id51">Support for Metaprogramming</a></li>
<li><a class="reference internal" href="#management-of-units" id="id52">Management of Units</a><ul>
<li><a class="reference internal" href="#motivation" id="id53">Motivation</a></li>
<li><a class="reference internal" href="#available-support" id="id54">Available Support</a></li>
<li><a class="reference internal" href="#specifying-units" id="id55">Specifying Units</a><ul>
<li><a class="reference internal" href="#aliases" id="id56">Aliases</a></li>
<li><a class="reference internal" href="#built-in-units" id="id57">Built-in Units</a></li>
<li><a class="reference internal" href="#composing-one-s-units" id="id58">Composing One's Units</a></li>
<li><a class="reference internal" href="#checking-units" id="id59">Checking Units</a></li>
</ul>
</li>
<li><a class="reference internal" href="#possible-improvements-regarding-dimensional-analysis" id="id60">Possible Improvements Regarding Dimensional Analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql-support" id="id61">SQL support</a><ul>
<li><a class="reference internal" href="#about-sql" id="id62">About SQL</a></li>
<li><a class="reference internal" href="#database-back-end" id="id63">Database Back-end</a></li>
<li><a class="reference internal" href="#erlang-sql-binding" id="id64">Erlang SQL Binding</a></li>
<li><a class="reference internal" href="#sql-support-provided-by-the-myriad-layer" id="id65">SQL Support Provided By the <em>Myriad</em> Layer</a></li>
<li><a class="reference internal" href="#sql-related-troubleshooting" id="id66">SQL-related Troubleshooting</a><ul>
<li><a class="reference internal" href="#compiling-module-sql-support-erl-can-t-find-include-file-sqlite3-hrl" id="id67">Compiling module sql_support.erl : can't find include file &quot;sqlite3.hrl&quot;</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#myriad-gotchas" id="id68"><tt class="docutils literal">Myriad</tt> Gotchas</a><ul>
<li><a class="reference internal" href="#header-dependencies" id="id69">Header dependencies</a></li>
<li><a class="reference internal" href="#about-the-table-module" id="id70">About the <tt class="docutils literal">table</tt> module</a></li>
</ul>
</li>
<li><a class="reference internal" href="#support-for-myriad" id="id71">Support for <tt class="docutils literal">Myriad</tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#please-react" id="id72">Please React!</a></li>
<li><a class="reference internal" href="#contributions-ending-word" id="id73">Contributions &amp; Ending Word</a></li>
</ul>
</li>
</ul>
</div>
<p></p>
<div class="section" id="overview-context">
<h2><a class="toc-backref" href="#id23">Overview &amp; Context</a></h2>
<p>When using any programming language, there are always <strong>recurring patterns</strong> that prove useful.</p>
<p>Instead of writing them again and again, we preferred gathering them all in a <strong>low-level layer</strong> (mostly a modest <strong>code library</strong>), in their most convenient, reliable, efficient version, together with their specification, documentation and testing.</p>
<p>This layer provides its (generally lightweight, simple) services just on top of the <a class="reference external" href="http://erlang.org">Erlang</a> <a class="footnote-reference" href="#id3" id="id2">[1]</a> language, as a relatively small (comprising currently about 70k lines), thin layer.</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>If needing to discover/learn Erlang, we recommend browsing <a class="reference external" href="https://learnyousomeerlang.com">Learn You Some Erlang for great good!</a> or, even better, buying their book!</td></tr>
</tbody>
</table>
<p>These services tend to stay away from introducing any new dependency. Should a key, generic service need a third-party prerequisite (ex: library to manage a complex data format, or to process specific data), that dependency should be made fully optional <a class="footnote-reference" href="#id5" id="id4">[2]</a> (then, should that dependency be found not available at build or run time, the corresponding service would be transparently disabled).</p>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>One may refer for example to what we did respectively for HDF5 and for JSON parsers in the context of REST support, with the <tt class="docutils literal">USE_HDF5</tt> and <tt class="docutils literal">USE_REST</tt> Make variables.</td></tr>
</tbody>
</table>
<p>As a consequence, for the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan">Ceylan</a> project, the first level of the Erlang-based software stack that we use relies on this <tt class="docutils literal">Myriad</tt> layer - whose official, more specific name is the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> <a class="footnote-reference" href="#id8" id="id7">[3]</a> layer.</p>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[3]</a></td><td>It was formerly known as the <tt class="docutils literal">Common</tt> layer.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="usage-guidelines">
<h2><a class="toc-backref" href="#id24">Usage Guidelines</a></h2>
<div class="section" id="license">
<h3><a class="toc-backref" href="#id25">License</a></h3>
<p>The <tt class="docutils literal">Myriad</tt> layer is licensed by its author (Olivier Boudeville) under a disjunctive tri-license, giving you the choice of one of the three following sets of free software/open source licensing terms:</p>
<ul class="simple">
<li>the <a class="reference external" href="http://www.mozilla.org/MPL/MPL-1.1.html">Mozilla Public License</a> (MPL), version 1.1 or later (very close to the former <a class="reference external" href="http://www.erlang.org/EPLICENSE">Erlang Public License</a>, except aspects regarding Ericsson and/or the Swedish law)</li>
<li>the <a class="reference external" href="http://www.gnu.org/licenses/gpl-3.0.html">GNU General Public License</a> (GPL), version 3.0 or later</li>
<li>the <a class="reference external" href="http://www.gnu.org/licenses/lgpl.html">GNU Lesser General Public License</a> (LGPL), version 3.0 or later</li>
</ul>
<p>This allows the use of the <tt class="docutils literal">Myriad</tt> code in as wide a variety of software projects as possible, while still maintaining copyleft on this code.</p>
<p>Being triple-licensed means that someone (the licensee) who modifies and/or distributes it can choose which of the available sets of licence terms he/she is operating under.</p>
<p>Enhancements are expected to be back-contributed (hopefully), so that everyone can benefit from them.</p>
</div>
<div class="section" id="about-layers">
<h3><a class="toc-backref" href="#id26">About Layers</a></h3>
<p>The <tt class="docutils literal">Myriad</tt> services are to be used by this layer itself (for its inner workings), and, more importantly, are to be re-used, specialised and enriched by layers built on top of it.</p>
<p>The general rule is that a layer may depend on (i.e. make use of) all layers <em>below</em> it (not only the one just preceding it), but cannot refer to any layer <em>above</em> it (it should be literally unaware of their existence).</p>
<p>So, in a bottom-up view, generally a software stack mentioned here begins with the operating system (typically GNU/Linux), then <a class="reference external" href="http://erlang/org">Erlang/OTP</a>, then <tt class="docutils literal">Myriad</tt>, then any layer(s) built on top of them (ex: <a class="reference external" href="http://wooper.esperide.org">WOOPER</a>).</p>
<p>Of course a given layer does not mask the layers below; for example programs using the <tt class="docutils literal">Myriad</tt> layer typically use also a lot the services brought by the <a class="reference external" href="http://erlang.org/erldoc">Erlang base libraries</a>.</p>
</div>
<div class="section" id="recommended-usage-contribution">
<h3><a class="toc-backref" href="#id27">Recommended Usage &amp; Contribution</a></h3>
<p>When developing Ceylan-based code, if needing a service already provided by this <tt class="docutils literal">Myriad</tt> layer, it is strongly advised to use that service and, possibly (if useful), expand or enrich it, with backward compatibility in mind.</p>
<p>If such a service is not provided by the current version of the layer, yet is deemed generic enough, then it should preferably be directly added to the relevant part of the library and called from the code that was needing it.</p>
<p>Of course, contributions of all sorts are welcome.</p>
<p>We do our best to test, at least lightly, each element provided. All services offered in a <tt class="docutils literal">foo.erl</tt> file are thus expected to be tested in the companion <tt class="docutils literal">foo_test.erl</tt> file, generally located in the same directory. Once there, running this test is as simple as executing:</p>
<pre class="code bash literal-block">
$ make foo_run
</pre>
<p>Note that however we have not reached the discipline level of an exhaustive <tt class="docutils literal">eunit</tt> test suite for each service (most of them being almost trivial).</p>
<p>The <a class="reference external" href="http://erlang.org/doc/apps/dialyzer/dialyzer_chapter.html">Dialyzer</a> static analysis tool is regularly run on the code-base (see the <tt class="docutils literal"><span class="pre">generate-local-plt</span></tt> and <tt class="docutils literal"><span class="pre">self-check-against-plt</span></tt> generic Make targets for that).</p>
</div>
</div>
<div class="section" id="getting-myriad">
<h2><a class="toc-backref" href="#id28">Getting Myriad</a></h2>
<div class="section" id="prerequisites">
<span id="prerequisite"></span><h3><a class="toc-backref" href="#id29">Prerequisites</a></h3>
<p>The <strong>operating system</strong> is supposed to be any not-so-old <tt class="docutils literal">GNU/Linux</tt> distribution <a class="footnote-reference" href="#id10" id="id9">[4]</a>.</p>
<p>People reported uses of Myriad on <tt class="docutils literal">Mac OS</tt>, yet no extensive testing has been done there.</p>
<p>Whereas Erlang supports <tt class="docutils literal">Windows</tt> and we tried to be as cross-platform as possible, even with tools like <tt class="docutils literal">MSYS2</tt> / <tt class="docutils literal"><span class="pre">MinGW-w64</span></tt> we suppose quite a lot of special cases would have to be addressed (patches welcome, though!).</p>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[4]</a></td><td>For what it is worth, we prefer <a class="reference external" href="https://www.archlinux.org/">Arch Linux</a>, but this des not really matter here.</td></tr>
</tbody>
</table>
<p>The main tool prerequisite is of course having the <a class="reference external" href="http://erlang.org">Erlang</a> environment available, in its <tt class="docutils literal">21.0</tt> version or more recent.</p>
<p>There are various ways of obtaining it (from your distribution, from prebuilt packages, directly from the sources), one of which being our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/install-erlang.sh">install-erlang.sh</a> script; see its <tt class="docutils literal"><span class="pre">--help</span></tt> option for more guidance.</p>
</div>
<div class="section" id="getting-the-sources">
<h3><a class="toc-backref" href="#id30">Getting the Sources</a></h3>
<p>This is pretty straightforward:</p>
<pre class="code bash literal-block">
$ git clone https://github.com/Olivier-Boudeville/Ceylan-Myriad.git
</pre>
<p>This should download in your current directory the full Myriad repository.</p>
</div>
<div class="section" id="building-myriad">
<span id="build"></span><h3><a class="toc-backref" href="#id31">Building Myriad</a></h3>
<p>This is as simple as:</p>
<pre class="code bash literal-block">
$ <span class="nb">cd</span> Ceylan-Myriad
$ make all
</pre>
<p>The parallel build of the whole layer (services and tests alike) shall complete successfully (if it is not the case, see our <a class="reference internal" href="#support">support</a> section).</p>
<p>One may just run <tt class="docutils literal">make</tt> by itself in order to list the main available options.</p>
</div>
<div class="section" id="testing-myriad">
<span id="testing"></span><h3><a class="toc-backref" href="#id32">Testing Myriad</a></h3>
<p>Just run, still from the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> directory:</p>
<pre class="code bash literal-block">
$ make <span class="nb">test</span>
</pre>
<p>The testing shall complete successfully (if it is not the case, see our <a class="reference internal" href="#support">support</a> section).</p>
</div>
<div class="section" id="type-checking-myriad">
<span id="type-checking"></span><h3><a class="toc-backref" href="#id33">Type-checking Myriad</a></h3>
<p>As Myriad is (by default) to enable debug information with a key-based protection of the resulting BEAM files, one should first have such key defined.</p>
<p>One way of doing so is, if wanted, to update the default key (see <tt class="docutils literal">DEBUG_INFO_KEY</tt> in <tt class="docutils literal">GNUmakevars.inc</tt>) and to write in on disk (ex: <tt class="docutils literal">make <span class="pre">write-debug-key-file</span></tt>), and to rebuild Myriad accordingly afterwards (ex: <tt class="docutils literal">make rebuild</tt>).</p>
<p>Then, still from the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> root directory:</p>
<pre class="code bash literal-block">
$ make generate-local-plt self-check-against-plt
</pre>
<p>It will trigger a full type-checking of Myriad, done thanks to <a class="reference external" href="http://erlang.org/doc/man/dialyzer.html">Dialyzer</a>.</p>
<p>This time-consuming phase will complete with a rather long list of notifications. Help us reducing it! These messages are numerous, but we do not think that most of them are so worrying.</p>
<p>Finally, to trigger in one go a full rebuild, testing and type-checking, one may run:</p>
<pre class="code bash literal-block">
$ make check
</pre>
<p></p>
</div>
</div>
<div class="section" id="services-offered-by-the-myriad-layer">
<h2><a class="toc-backref" href="#id34">Services offered by the <tt class="docutils literal">Myriad</tt> Layer</a></h2>
<p>The <tt class="docutils literal">Myriad</tt> services are gathered into following themes:</p>
<ol class="arabic simple">
<li>General <a class="reference internal" href="#build-structure">build structure</a></li>
<li>General <a class="reference internal" href="#settings">settings</a></li>
<li><a class="reference internal" href="#maths">Maths</a> services</li>
<li><a class="reference internal" href="#data-management">Data-management</a> services</li>
<li>Helpers for <a class="reference internal" href="#graphical-user-interface">graphical user interface</a> (GUI) programming</li>
<li>All-purpose <a class="reference internal" href="#helper-scripts">helper scripts</a></li>
<li>Utility <a class="reference internal" href="#toolbox">toolbox</a></li>
<li>Management of <a class="reference internal" href="#units">units</a></li>
<li><a class="reference internal" href="#metaprogramming">Metaprogramming</a>, based on heavy use of parse transforms</li>
<li><a class="reference internal" href="#sql-support">SQL support</a></li>
</ol>
<p>In future versions of this document, following topics will be discussed:</p>
<ul class="simple">
<li>HDF5 support</li>
<li>REST support</li>
<li>third-party language bindings (ex: Python, Java, maybe in the future Haskell; C/C++ is to be tackled by our <a class="reference external" href="http://seaplus.esperide.org">Seaplus</a> project)</li>
<li>RDF support</li>
</ul>
<p>Even if this document does not constitute an exhaustive walk-through, each of them is detailed in turn below.</p>
<p>The next level of detail is to peer at the referenced source files, as they include many implementation notes, comments and typing information.</p>
<p></p>
<div class="section" id="general-build-structure">
<span id="build-structure"></span><h3><a class="toc-backref" href="#id35">General Build Structure</a></h3>
<p>Various elements are defined at the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> level to set-up an appropriate build, based on <a class="reference external" href="http://www.gnu.org/software/make/manual/make.html">GNU Make</a>.</p>
<p>This includes:</p>
<ul class="simple">
<li>a set of pre-defined Make <strong>variables</strong>, describing various settings that will be reused by generic rules (ex: to compile modules with relevant flags, to create source archives, to install an application, to manage the various paths, to perform test checking, to generate archives, installs and releases, etc.); these variables are defined in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/GNUmakevars.inc</span></tt></li>
<li>a set of generic <strong>rules</strong>, to compile and run various modules and tests, to generate various elements of documentation, etc.; these rules are defined (still from the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> root directory), in:<ul>
<li><tt class="docutils literal"><span class="pre">GNUmakerules-automatic.inc</span></tt>, for all rules that apply generically to a some kinds of targets</li>
<li><tt class="docutils literal"><span class="pre">GNUmakerules-explicit.inc</span></tt>, for all &quot;direct&quot; rules, that are not pattern-based</li>
<li><tt class="docutils literal"><span class="pre">doc/GNUmakerules-docutils.inc</span></tt>, for all documentation-related rules</li>
</ul>
</li>
<li>finally, the whole is gathered in a unique file to include, <tt class="docutils literal">GNUmakesettings.inc</tt>, whose structure allows for a safe and sound combination of all these build element across a series of layers (the first of which being Myriad)</li>
<li><strong>examples</strong> of minimal Make files, which mostly specify the relative base path and only refer to the generic variables and rules; see <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/GNUmakefile</span></tt> as an example</li>
</ul>
<p>These build facilities are designed to be enriched in turn by all layers above, which may add or override variables and rules.</p>
<p>An example of this stacked structure is the <tt class="docutils literal"><span class="pre">Ceylan-WOOPER</span></tt> layer (see <a class="reference external" href="http://wooper.esperide.org">official site</a>), which is directly built on top of <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> (and itself a base layer for other layers and applications).</p>
<p></p>
</div>
<div class="section" id="general-settings">
<span id="settings"></span><h3><a class="toc-backref" href="#id36">General Settings</a></h3>
<p>These general-purpose settings and helpers, gathered in the <tt class="docutils literal"><span class="pre">Ceylan-Myriad/conf</span></tt> directory, deal with:</p>
<ul class="simple">
<li>default CSS files (<tt class="docutils literal"><span class="pre">Default-docutils.css</span></tt>)</li>
<li>our recommended versions of (commented) configuration files for various tools:</li>
</ul>
<blockquote>
<ul class="simple">
<li>for <tt class="docutils literal">Emacs</tt>: <tt class="docutils literal">init.el</tt>, to be placed in the <tt class="docutils literal"><span class="pre">~/.emacs.d/</span></tt> directory</li>
<li>for <tt class="docutils literal">Nedit</tt>: <tt class="docutils literal">nedit.rc</tt>, to be placed in the <tt class="docutils literal"><span class="pre">~/.nedit/</span></tt> directory</li>
</ul>
</blockquote>
<ul class="simple">
<li>our standard script to properly install Erlang (<tt class="docutils literal"><span class="pre">install-erlang.sh</span></tt>) with detailed comments and command-line options (use <tt class="docutils literal"><span class="pre">install-erlang.sh</span> <span class="pre">--help</span></tt> for more information)</li>
</ul>
<p></p>
</div>
<div class="section" id="maths-services">
<span id="maths"></span><h3><a class="toc-backref" href="#id37">Maths Services</a></h3>
<p>Some simple maths-related operations are defined in the <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/maths</span></tt> directory:</p>
<ul class="simple">
<li>the most basic services are centralised in <tt class="docutils literal">math_utils.erl</tt> and provide:<ul>
<li><strong>general operations</strong> apparently lacking to Erlang (for example for conversions or rounding (<tt class="docutils literal">floor/1</tt>, <tt class="docutils literal">ceiling/1</tt>), or not exactly implemented as we would have liked (ex: <tt class="docutils literal">modulo/2</tt>)</li>
<li>operations tailored to operate on <strong>floating-point values</strong> (ex: <tt class="docutils literal"><span class="pre">are_close/{2,3}</span></tt>, <tt class="docutils literal"><span class="pre">are_relatively_close/{2,3}</span></tt>, <tt class="docutils literal">get_relative_difference/2</tt>, <tt class="docutils literal">is_null/1</tt>)</li>
<li>operations on <strong>angles</strong> (ex: <tt class="docutils literal">radian_to_degree/1</tt>, <tt class="docutils literal">canonify/1</tt>)</li>
<li>the associated <strong>typing</strong> information</li>
</ul>
</li>
<li>linear-related operations are defined; for example the <strong>2D</strong> operations are defined in <tt class="docutils literal">linear_2D.erl</tt> (their <strong>3D</strong> counterparts being defined in <tt class="docutils literal">linear_3D.erl</tt>, their <strong>4D</strong> counterparts in <tt class="docutils literal">linear_4D.erl</tt>; base ones in <tt class="docutils literal">linear.erl</tt>) and include:<ul>
<li>operations on <strong>points</strong>: <tt class="docutils literal">are_close/2</tt>, <tt class="docutils literal">is_within/3</tt>, <tt class="docutils literal">square_distance/2</tt>, <tt class="docutils literal">distance/2</tt>, <tt class="docutils literal">cross_product/2</tt>, <tt class="docutils literal">roundify/1</tt>, <tt class="docutils literal">get_integer_center/2</tt>, <tt class="docutils literal">get_center/2</tt>, <tt class="docutils literal">translate/2</tt>, etc.</li>
<li>operations on <strong>vectors</strong>: <tt class="docutils literal">vectorize/2</tt>, <tt class="docutils literal">square_magnitude/1</tt>, <tt class="docutils literal">magnitude/1</tt>, <tt class="docutils literal">scale/2</tt>, <tt class="docutils literal">make_unit/1</tt>, <tt class="docutils literal">normal_left/1</tt>, <tt class="docutils literal">normal_right/1</tt>, <tt class="docutils literal">dot_product/2</tt>, etc.</li>
<li>operations on <strong>lines</strong>: <tt class="docutils literal">get_line/2</tt>, <tt class="docutils literal">intersect/2</tt>, <tt class="docutils literal">get_abscissa_for_ordinate/2</tt>, etc.</li>
<li>operations related to <strong>angles</strong>: <tt class="docutils literal">is_strictly_on_the_right/3</tt>, <tt class="docutils literal">is_obtuse/1</tt>, <tt class="docutils literal">abs_angle_rad/3</tt>, <tt class="docutils literal">angle_rad/3</tt>, <tt class="docutils literal">abs_angle_deg/3</tt>, <tt class="docutils literal">angle_deg/3</tt>, etc.</li>
<li>operations on <strong>sets of points</strong>: <tt class="docutils literal">compute_smallest_enclosing_rectangle/1</tt>, <tt class="docutils literal">compute_max_overall_distance/1</tt>, <tt class="docutils literal">compute_convex_hull/1</tt>, etc.</li>
</ul>
</li>
<li><strong>polygon</strong>-related operations are available in <tt class="docutils literal">polygon.erl</tt>:<ul>
<li><strong>generation</strong> of polygons: <tt class="docutils literal">get_triangle/3</tt>, <tt class="docutils literal">get_upright_square/2</tt>, <tt class="docutils literal">get_polygon/1</tt>, etc.</li>
<li><strong>operations</strong> on them: <tt class="docutils literal">get_diameter/1</tt>, <tt class="docutils literal">get_smallest_enclosing_rectangle/1</tt>, <tt class="docutils literal">get_area/1</tt>, <tt class="docutils literal">is_in_clockwise_order/1</tt>, <tt class="docutils literal">is_convex/1</tt>, <tt class="docutils literal">to_string/1</tt>, etc.</li>
<li><strong>rendering</strong> them: <tt class="docutils literal">render/2</tt>, <tt class="docutils literal">set_edge_color/2</tt>, <tt class="docutils literal">get_edge_color/1</tt>, <tt class="docutils literal">set_fill_color/2</tt>, <tt class="docutils literal">get_fill_color/1</tt>, etc.</li>
<li>managing their <strong>bounding boxes</strong>: <tt class="docutils literal">update_bounding_box/2</tt>, etc.</li>
</ul>
</li>
<li><strong>bounding-boxes in general</strong> are supported in <tt class="docutils literal">bounding_box.erl</tt>, including <tt class="docutils literal">get_lazy_circle_box/1</tt>, <tt class="docutils literal">get_minimal_enclosing_circle_box/1</tt>, etc.</li>
<li>a minimalist <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods#The_Runge.E2.80.93Kutta_method">Runge-Kutta solver</a> is defined in <tt class="docutils literal">rk4_solver.erl</tt></li>
</ul>
<p></p>
</div>
<div class="section" id="data-management-services">
<span id="data-management"></span><h3><a class="toc-backref" href="#id38">Data-Management Services</a></h3>
<p id="table-type">Some generic <strong>data-structures</strong>, in addition to the ones provided built-in with Erlang, are defined in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/data-management</span></tt>, notably:</p>
<ul class="simple">
<li>a set of <strong>associative tables</strong>, with a rather complete interface (to create,
update, enrich, search, query, list, map, fold, merge, display, etc.) and
various implementations thereof, tests and benchmarks, in:</li>
</ul>
<pre class="code erlang literal-block">
<span class="p">{</span><span class="nb">hash</span><span class="p">,</span><span class="n">lazy_hash</span><span class="p">,</span><span class="n">list_</span><span class="p">,</span><span class="n">tracked_hash</span><span class="p">,</span><span class="n">map_hash</span><span class="p">}</span><span class="n">table</span><span class="p">.</span><span class="n">erl</span>
</pre>
<ul class="simple">
<li>a <tt class="docutils literal">table</tt> <strong>pseudo-module</strong> to abstract them out from the user's point of view; note that this is a fully virtual module, in the sense that neither <tt class="docutils literal">table.erl</tt> nor <tt class="docutils literal">table.beam</tt> exist (the <tt class="docutils literal">Myriad</tt> parse transform replaces a call to the <tt class="docutils literal">table</tt> module by, currently, a call to the <tt class="docutils literal">map_table</tt> module; so, in order to consult the <tt class="docutils literal">table</tt> API, please refer to <tt class="docutils literal">map_table.erl</tt>)</li>
<li>a way of <strong>generating a read-only associative table</strong> whose key/value pairs can be read from any number (potentially extremely large) of readers very efficiently (<tt class="docutils literal">const_table.erl</tt>)</li>
<li>a specific support for <strong>other datatypes</strong> (<tt class="docutils literal">pair.erl</tt>, <tt class="docutils literal">option_list.erl</tt>, <tt class="docutils literal">preferences.erl</tt>, <tt class="docutils literal">tree.erl</tt>)</li>
<li>a first-level, optional support of the <a class="reference external" href="https://www.hdfgroup.org/HDF5/">HDF5</a> file format (based on, and thus requiring, the <a class="reference external" href="https://github.com/Olivier-Boudeville-EDF/erlhdf5">enhanced fork</a> we made of <a class="reference external" href="https://github.com/RomanShestakov/erlhdf5">erlhdf5</a>)</li>
</ul>
<p>Finally, the <tt class="docutils literal">void/0</tt> and <tt class="docutils literal">maybe/1</tt> types are supported (thanks to the Myriad parse-transform).</p>
<p></p>
</div>
<div class="section" id="support-for-code-injection">
<span id="code-injection"></span><h3><a class="toc-backref" href="#id39">Support for Code Injection</a></h3>
<p>It may be useful to decide, at compile-time, based on tokens specified on the command-line, whether some code should be enabled.</p>
<div class="section" id="defining-a-token">
<h4><a class="toc-backref" href="#id40">Defining a token</a></h4>
<p>A <em>token</em> (a symbol) may or may not defined.</p>
<p>To define <tt class="docutils literal">my_token</tt>, simply ensure that the a <tt class="docutils literal"><span class="pre">-Dmy_token</span></tt> command-line option is specified to the compiler (ex: refer to <tt class="docutils literal">ERLANG_COMPILER_TOKEN_OPT</tt>, in <tt class="docutils literal">GNUmakevars.inc</tt>).</p>
<p>To define <tt class="docutils literal">my_token</tt> and set it to the integer value <tt class="docutils literal">127</tt>, use the <tt class="docutils literal"><span class="pre">-Dmy_token=127</span></tt> command-line option. Values can also be floats (ex: <tt class="docutils literal"><span class="pre">-Dmy_token=3.14</span></tt>) or atoms (ex: <tt class="docutils literal"><span class="pre">-Dmy_token=some_atom</span></tt>).</p>
<p>A special token is <tt class="docutils literal">debug_mode</tt>; if it is defined at all (and possibly associated to any value), the debug mode of Myriad is enabled.</p>
</div>
<div class="section" id="using-tokens-to-enable-code-injection">
<h4><a class="toc-backref" href="#id41">Using tokens to enable code injection</a></h4>
<p>Various primitives for <em>code injection</em> are available in the <tt class="docutils literal">cond_utils</tt> (mostly pseudo-) module.</p>
<p><tt class="docutils literal">if_debug/1</tt>, for example used as:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_debug</span><span class="p">([</span><span class="nv">A</span><span class="o">=</span><span class="nv">B</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Hello </span><span class="si">~p</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">A</span><span class="p">])])</span>
</pre>
<p>will enable the specified code (either an arbitrarily nested expression or a list thereof) iff (if and only if) the <tt class="docutils literal">debug_mode</tt> token has been defined.</p>
<p>Similarly, <tt class="docutils literal">if_defined/2</tt>, for example used as:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_defined</span><span class="p">(</span><span class="n">my_token</span><span class="p">,[</span><span class="nv">EXPR1</span><span class="p">,</span><span class="nv">EXPR2</span><span class="p">,...])</span>
</pre>
<p>will inject <tt class="docutils literal">EXPR1</tt>, <tt class="docutils literal">EXPR2</tt>, etc. if <tt class="docutils literal">my_token</tt> has been defined (any value associated to this token value will be ignored), otherwise the <tt class="docutils literal">if_defined/2</tt> call will be removed as a whole <a class="footnote-reference" href="#id14" id="id13">[5]</a>.</p>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[5]</a></td><td>So <tt class="docutils literal"><span class="pre">if_debug([...])</span></tt> behaves exactly as: <tt class="docutils literal"><span class="pre">if_defined(debug_mode,[...])</span></tt>.</td></tr>
</tbody>
</table>
<p>As for <tt class="docutils literal">if_defined/3</tt>, it supports two lists of expressions:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_defined</span><span class="p">(</span><span class="n">a_token</span><span class="p">,</span><span class="nv">FIRST_EXPR_LIST</span><span class="p">,</span><span class="nv">SECOND_EXPR_LIST</span><span class="p">])</span>
</pre>
<p>If <tt class="docutils literal">a_token</tt> has been defined, the first list will be injected, otherwise the second will be.</p>
<p>Finally, with <tt class="docutils literal"><span class="pre">if_set_to/{3,4}</span></tt>, the injection will depend not only of a token being defined or not, but also onto the value (if any) to which it is associated.</p>
<p>An example with <tt class="docutils literal">if_set_to/3</tt>:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_set_to</span><span class="p">(</span><span class="n">some_token</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="nv">EXPR_LIST</span><span class="p">)</span>
</pre>
<p>will inject <tt class="docutils literal">EXPR_LIST</tt> iff <tt class="docutils literal">some_token</tt> has been defined and set to <tt class="docutils literal">42</tt> (i.e. <tt class="docutils literal"><span class="pre">-Dsome_token=42</span></tt>). As a result, the specified expressions will not be injected if <tt class="docutils literal">some_token</tt> has been set to another value, or not been defined at all. As usual, instead of a list of expressions, a single expression may be specified.</p>
<p>As for <tt class="docutils literal">if_set_to/4</tt>, in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_set_to</span><span class="p">(</span><span class="n">a_token</span><span class="p">,</span><span class="n">a_symbol</span><span class="p">,</span><span class="nv">FIRST_EXPR_LIST</span><span class="p">,</span><span class="nv">SECOND_EXPR_LIST</span><span class="p">)</span>
</pre>
<p><tt class="docutils literal">FIRST_EXPR_LIST</tt> will be injected iff <tt class="docutils literal">a_token</tt> has been defined and set to <tt class="docutils literal">a_symbol</tt>, otherwise <tt class="docutils literal">SECOND_EXPR_LIST</tt> will be.</p>
</div>
<div class="section" id="controlling-assertions">
<h4><a class="toc-backref" href="#id42">Controlling assertions</a></h4>
<p>It may be convenient that, depending on a compile-time token (ex: in debug mode, typically triggered thanks to the <tt class="docutils literal"><span class="pre">-Ddebug_mode</span></tt> compilation option), <em>assertions</em> (expressions expected to evaluate to the atom <tt class="docutils literal">true</tt>) are enabled, whereas they shall be dismissed as a whole should that token not be defined.</p>
<p>To define an assertion enabled in debug mode, use <tt class="docutils literal">assert/1</tt>, like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span><span class="nv">B</span><span class="p">)</span><span class="o">=:=</span><span class="mi">10</span><span class="p">)</span>
</pre>
<p>Should at runtime the expression specified to <tt class="docutils literal">assert/1</tt> be evaluated to a value <tt class="docutils literal">V</tt> that is different from the atom <tt class="docutils literal">true</tt>, a <tt class="docutils literal">{assertion_failed,V}</tt> exception will be thrown.</p>
<p>More generally, an assertion may be enabled by any token (not <tt class="docutils literal">debug_mode</tt> only) being defined, like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">my_token</span><span class="p">,</span><span class="n">bar</span><span class="p">(</span><span class="nv">C</span><span class="p">))</span>
</pre>
<p>Finally, an assertion may be enabled iff a token (here, <tt class="docutils literal">some_token</tt>) has been defined and set to a given value (here, <tt class="docutils literal">42</tt>), like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">some_token</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="ow">not</span> <span class="n">baz</span><span class="p">()</span> <span class="ow">andalso</span> <span class="nv">A</span><span class="p">)</span>
</pre>
<p>This may be useful for example to control, on a per-theme basis, the level of checking performed, like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">debug_gui</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">basic_testing</span><span class="p">()),</span>
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">debug_gui</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">more_involved_testing</span><span class="p">()),</span>
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">debug_gui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">paranoid_testing</span><span class="p">()),</span>
</pre>
<p>Note that, in this case, a given level of checking should include the one just below it (ex: <tt class="docutils literal">more_involved_testing()</tt> should call <tt class="docutils literal">basic_testing()</tt>).</p>
</div>
<div class="section" id="for-more-information">
<h4><a class="toc-backref" href="#id43">For more information</a></h4>
<p>Refer for usage and stubs to the <tt class="docutils literal">cond_utils</tt> module (defined in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/meta</span></tt>), knowing that it is actually implemented thanks to the Myriad parse transform.</p>
<p>For examples and testing, see the <tt class="docutils literal">cond_utils_test</tt> module, available at the same location.</p>
<p></p>
</div>
</div>
<div class="section" id="helpers-for-user-interface-programming">
<span id="graphical-user-interface"></span><span id="user-interface"></span><h3><a class="toc-backref" href="#id44">Helpers For User Interface Programming</a></h3>
<p>Some services have been defined, in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/user-interface</span></tt>, in order to handle more easily interactions with the user, i.e. to provide a user interface.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The user-interface services, as a whole, are currently <em>not</em> functional. A rewriting thereof as been started yet has not completed yet.</p>
</div>
<div class="section" id="various-flavours-of-user-interfaces">
<h4><a class="toc-backref" href="#id45">Various Flavours of User Interfaces</a></h4>
<p>Such a user interface may be:</p>
<ul class="simple">
<li>either <strong>text-only</strong>, within a console, relying either on the very basic <tt class="docutils literal">text_ui</tt> (for raw text) or its more advanced <tt class="docutils literal">term_ui</tt> counterpart (for terminal-based outputs)</li>
<li>or <strong>graphical</strong>, with <tt class="docutils literal">gui</tt></li>
</ul>
<p>Text-based user interfaces are quite useful, as they are lightweight, incur few dependencies (if any), and can be used for headless remote servers (<tt class="docutils literal">text_ui</tt> and <tt class="docutils literal">term_ui</tt> work well through SSH, and require no X server nor mouse).</p>
<p>As for graphical-based user interfaces, they are the richest, most usual, and generally the most convenient, user-friendly interfaces.</p>
<p>User interfaces tend to have a <strong>state</strong>, which can be:</p>
<ul class="simple">
<li>either <tt class="docutils literal">explicit</tt>, in a functional way; thus having to be carried in all calls</li>
<li>or <tt class="docutils literal">implicit</tt>, using, for that very specific need only, the process dictionary (even if otherwise we never use it)</li>
</ul>
<p>We tested the two approaches and preferred the latter (implicit) one, which thus finally fully superseded the (former) explicit one.</p>
<p>We made our best so that a lower-level API interface (relying on a more basic backend) is <strong>strictly included</strong> in the higher-level ones (ex: <tt class="docutils literal">term_ui</tt> adds concepts - like the one of window or box - to the line-based <tt class="docutils literal">text_ui</tt>), in order that any program using a given user interface may use any of the next, upper ones as well (provided implicit states are used), in the following order: the <tt class="docutils literal">text_ui</tt> API is included in the one of <tt class="docutils literal">term_ui</tt>, which is itself included in the one of <tt class="docutils literal">gui</tt>.</p>
<p>We also defined the <strong>settings table</strong>, which is a table gathering all the settings specified by the developer that the user interface does its best to accommodate.</p>
<p>Thanks to these &quot;Matryoshka&quot; APIs and the settings table, the definition of a more generic <tt class="docutils literal">ui</tt> interface has been possible. It selects automatically, based on available local software dependencies, <strong>the most advanced available backend</strong>, with the most relevant settings.</p>
<p>For example a relevant backend will be automatically selected by:</p>
<pre class="code bash literal-block">
$ <span class="nb">cd</span> src/user-interface/src
$ make ui_run
</pre>
<p>On the other hand, if wanting to select a specified backend:</p>
<pre class="code bash literal-block">
$ make ui_run <span class="nv">CMD_LINE_OPT</span><span class="o">=</span><span class="s2">&quot;--use-ui-backend term_ui&quot;</span>
</pre>
<p>(see the corresponding <tt class="docutils literal">GNUmakefile</tt> for more information)</p>
</div>
<div class="section" id="raw-text-user-interface-text-ui">
<h4><a class="toc-backref" href="#id46">Raw Text User Interface: <tt class="docutils literal">text_ui</tt></a></h4>
<p>This is the most basic, line-based monochrome textual interface, directly in raw text with no cursor control.</p>
<p>Located in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/user-interface/textual</span></tt>, see <tt class="docutils literal">text_ui.erl</tt> for its implementation, and <tt class="docutils literal">text_ui_test.erl</tt> for an example of its use.</p>
</div>
<div class="section" id="terminal-text-user-interface-term-ui">
<h4><a class="toc-backref" href="#id47">Terminal Text User Interface: <tt class="docutils literal">term_ui</tt></a></h4>
<p>This is a more advanced textual interface than the previous one, with colors, dialog boxes, support of locales, etc., based on <a class="reference external" href="https://en.wikipedia.org/wiki/Dialog_(software)">dialog</a> (possibly <a class="reference external" href="https://en.wikipedia.org/wiki/Newt_(programming_library)">whiptail</a> could be supported as well). Such backend of course must be available on the execution host then.</p>
<p>For example, to secure these prerequisites:</p>
<pre class="code bash literal-block">
<span class="c1"># On Arch Linux:
</span>$ pacman -S dialog

<span class="c1"># On Debian-like distros:
</span>$ apt-get install dialog
</pre>
<p>Located in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/user-interface/textual</span></tt>, see <tt class="docutils literal">term_ui.erl</tt> for its implementation, and <tt class="docutils literal">term_ui_test.erl</tt> for an example of its use.</p>
</div>
<div class="section" id="graphical-user-interface-gui">
<h4><a class="toc-backref" href="#id48">Graphical User Interface: <tt class="docutils literal">gui</tt></a></h4>
<p>This interface relied initially on <a class="reference external" href="http://erlang.org/doc/man/gs.html">gs</a>, now on <a class="reference external" href="http://erlang.org/doc/man/wx.html">wx</a> (a port of <a class="reference external" href="https://www.wxwidgets.org/">wxWidgets</a>), maybe later in HTML 5. For the base dialogs, <a class="reference external" href="https://en.wikipedia.org/wiki/Zenity">Zenity</a> could have been on option.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">GUI services are currently being reworked, to provide a <tt class="docutils literal">gs</tt> like concurrent API while relying underneath on <tt class="docutils literal">wx</tt>, with some additions (such as canvases).</p>
</div>
<p>The goal is to provide a small, lightweight API (including message types) that are higher-level than <tt class="docutils literal">wx</tt>, and do not depend on any particular GUI backend (such as <tt class="docutils literal">wx</tt>, <tt class="docutils literal">gs</tt>, etc.) to avoid that user programs become obsolete too quickly, as backends for GUI rise and fall relatively often.</p>
<p>So for example the messages received by the user programs shall not mention <tt class="docutils literal">wx</tt>, and they should take the form of <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-WOOPER">WOOPER</a> messages to allow for user code that would rely on WOOPER.</p>
<p>Located in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/user-interface/graphical</span></tt>, see <tt class="docutils literal">gui.erl</tt>, <tt class="docutils literal">gui_color.erl</tt>, <tt class="docutils literal">gui_text.erl</tt>, <tt class="docutils literal">gui_canvas.erl</tt>, etc., with a few tests (<tt class="docutils literal">gui_test.erl</tt>, <tt class="docutils literal">lorenz_test.erl</tt>).</p>
<p>Related information of interest:</p>
<ul class="simple">
<li>wxErlang: <a class="reference external" href="https://arifishaq.files.wordpress.com/2017/12/wxerlang-getting-started.pdf">Getting started</a> and <a class="reference external" href="https://arifishaq.files.wordpress.com/2018/04/wxerlang-speeding-up.pdf">Speeding up</a>, by Arif Ishaq</li>
<li><a class="reference external" href="http://www.idiom.com/~turner/wxtut/wxwidgets.html">http://www.idiom.com/~turner/wxtut/wxwidgets.html</a></li>
<li><a class="reference external" href="http://wxerlang.dougedmunds.com/">http://wxerlang.dougedmunds.com/</a></li>
</ul>
<p></p>
</div>
</div>
<div class="section" id="all-purpose-helper-scripts">
<span id="helper-scripts"></span><h3><a class="toc-backref" href="#id49">All-Purpose Helper Scripts</a></h3>
<p>A small set of scripts has been defined, in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/scripts</span></tt>, in order to help:</p>
<ul class="simple">
<li>finding in (Erlang) source code <strong>type definitions</strong> (<tt class="docutils literal"><span class="pre">find-type-definition.sh</span></tt>, <tt class="docutils literal"><span class="pre">find-record-definition.sh</span></tt>) and <strong>function specifications</strong> (<tt class="docutils literal"><span class="pre">find-function-specification.sh</span></tt>)</li>
<li><strong>benchmarking</strong> Erlang code: <tt class="docutils literal"><span class="pre">benchmark-command.escript</span></tt>, <tt class="docutils literal"><span class="pre">benchmark-command.sh</span></tt>, <tt class="docutils literal">etop.sh</tt></li>
<li>generating <strong>documentation</strong>: <tt class="docutils literal"><span class="pre">generate-docutils.sh</span></tt>, <tt class="docutils literal"><span class="pre">generate-pdf-from-rst.sh</span></tt></li>
<li>supporting <strong>explicit typing</strong>: <tt class="docutils literal"><span class="pre">list-available-types.sh</span></tt>, <tt class="docutils literal"><span class="pre">add-deduced-type-specs.escript</span></tt></li>
<li>evaluating Erlang <strong>code size</strong>: <tt class="docutils literal"><span class="pre">make-code-stats.sh</span></tt></li>
<li><strong>running</strong> Erlang programs: <tt class="docutils literal"><span class="pre">launch-erl.sh</span></tt>, i.e. the (non-trivial) script that is automatically called by all our execution rules (i.e. we always run our Erlang programs through it)</li>
<li>parsing <strong>XML</strong> thanks to <tt class="docutils literal">xmerl</tt>: <tt class="docutils literal"><span class="pre">show-xml-file.escript</span></tt></li>
</ul>
<p>To be added: merging facilities (upcoming <tt class="docutils literal"><span class="pre">merge-tree.escript</span></tt>)</p>
<p></p>
</div>
<div class="section" id="utility-toolbox">
<span id="toolbox"></span><h3><a class="toc-backref" href="#id50">Utility Toolbox</a></h3>
<p>This is the <strong>core</strong> of the <tt class="docutils literal">Myriad</tt> library: a toolbox comprising many helper functions (with their tests), defined in the <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/utils</span></tt> directory, often providing enhanced, more specialised services compared to the ones offered by the Erlang standard libraries.</p>
<p>These helpers (code and typing information) are thematically aggregated in modules that are generally suffixed by <tt class="docutils literal">_utils</tt>, and include:</p>
<ul class="simple">
<li>many <strong>basic, general-purpose services</strong>, defined in <tt class="docutils literal">basic_utils.erl</tt>, regarding:</li>
</ul>
<blockquote>
<ul class="simple">
<li>the base types we defined</li>
<li>process registration</li>
<li>notifications</li>
<li>message handling</li>
<li>many miscellaneous functions</li>
</ul>
</blockquote>
<ul class="simple">
<li><strong>cipher</strong>-related facilities (basic, a bit exotic chained symmetric encryptions, notably with Mealy machines), in <tt class="docutils literal">cipher_utils.erl</tt></li>
<li>functions to manage Erlang <strong>compiled BEAM code</strong> (<tt class="docutils literal">code_utils.erl</tt>)</li>
<li>services to manage the <strong>execution of other programs</strong> (<tt class="docutils literal">executable_utils.erl</tt>), to:<ul>
<li>locate said executables</li>
<li>to execute functional services (ex: display a PDF) regardless of the actual executable involved</li>
<li>to handle more easily command-line arguments (a bit like <tt class="docutils literal">getopt</tt>), regardless of the interpreter or escript context</li>
</ul>
</li>
<li>helpers for <strong>file-based</strong> I/O operations (<tt class="docutils literal">file_utils.erl</tt>)</li>
<li>a very basic support of <strong>Finite State Machines</strong> (<tt class="docutils literal"><span class="pre">fsm_utils.{e,h}rl</span></tt>)</li>
<li>a few operations defined on <strong>graphs</strong> (<tt class="docutils literal">graph_utils.erl</tt>, with <tt class="docutils literal"><span class="pre">find_breadth_first/{3,4}</span></tt>)</li>
<li>extra operations defined on <strong>lists</strong> (<tt class="docutils literal">list_utils.erl</tt>), including rings</li>
<li>support for <strong>network</strong>-related concerns (<tt class="docutils literal"><span class="pre">net_utils.erl.{e,h}rl</span></tt>)</li>
<li>services to offer <strong>randomness</strong> (<tt class="docutils literal">random.erl</tt>), with regard to various sources (the Erlang built-in algorithm, <tt class="docutils literal">crypto</tt>, newer ones like <tt class="docutils literal">exsplus</tt> - our current default, <tt class="docutils literal">exs64</tt> and <tt class="docutils literal">exs1024</tt>), for seeding, drawing, etc.</li>
<li>very little support of <strong>RDF</strong> operations, standing for <a class="reference external" href="https://en.wikipedia.org/wiki/Resource_Description_Framework">Resource Description Framework</a> (<tt class="docutils literal">rdf_utils.erl</tt>)</li>
<li>facilities to perform <strong>REST calls</strong> (<tt class="docutils literal">rest_utils.erl</tt>), using built-in <tt class="docutils literal">httpc</tt> and <tt class="docutils literal">http_client</tt>, and possibly a JSON parser, <a class="reference external" href="https://github.com/talentdeficit/jsx/">jsx</a></li>
<li>elements for the sending of <strong>SMS</strong> (<tt class="docutils literal">sms_utils.erl</tt>), based either on third-party providers providing REST APIs, or via a mobile phone (typically connected thanks to a USB cable)</li>
<li>support for operations at the <strong>operating-system</strong> level (<tt class="docutils literal"><span class="pre">system_utils.{e,h}rl</span></tt>)</li>
<li>services to handle <strong>text</strong> (<tt class="docutils literal">text_utils.erl</tt>)</li>
<li>functions to manage <strong>time</strong> information (<tt class="docutils literal">time_utils.erl</tt>)</li>
<li>a few helpers to ease the writing of <a class="reference external" href="http://erlang.org/doc/man/escript.html">escripts</a> relying on the Myriad layer (<tt class="docutils literal">script_utils.erl</tt>)</li>
<li>services about all kinds of <strong>units</strong> (<tt class="docutils literal">unit_utils.erl</tt>); refer to the <a class="reference internal" href="#management-of-units">Management of Units</a> section below for more information</li>
<li>very basic facilities for <strong>applications</strong>, in <tt class="docutils literal"><span class="pre">app_facilities.{e,h}rl</span></tt> with an example (<tt class="docutils literal">most_basic_example_app.erl</tt>)</li>
</ul>
<p></p>
</div>
<div class="section" id="support-for-metaprogramming">
<span id="metaprogramming"></span><h3><a class="toc-backref" href="#id51">Support for Metaprogramming</a></h3>
<p>Over time, quite a lot of developments grew to form primitives that manage ASTs (<em>Astract Syntax Trees</em>), based on Erlang's parse transforms.</p>
<p>These developments are gathered in the <tt class="docutils literal">src/meta</tt> directory, providing notably:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">meta_utils.{e,h}rl</span></tt>: basic primitives to <strong>transform ASTs</strong>, with a bit of testing (<tt class="docutils literal">meta_utils_test</tt>)</li>
<li><tt class="docutils literal">type_utils</tt>: a still rather basic toolbox to <strong>manage data types</strong> - whether built-in, compound or parametrised (expressed as strings, as terms, etc.)</li>
<li><tt class="docutils literal">ast_*</tt> modules to handle the various <strong>elements that can be found in an AST</strong> (ex: <tt class="docutils literal">ast_expression</tt>, <tt class="docutils literal">ast_type</tt>, <tt class="docutils literal">ast_pattern</tt>, etc.)</li>
</ul>
<p>Finally, a few usage examples of these facilities are:</p>
<ul class="simple">
<li><tt class="docutils literal">minimal_parse_transform_test</tt>: the simplest parse transform test that we use, typically operating on <tt class="docutils literal">simple_parse_transform_target</tt></li>
<li><tt class="docutils literal">example_parse_transform</tt>: a rather minimal parse transform</li>
<li><tt class="docutils literal">myriad_parse_transform</tt>: the parse transform used within <tt class="docutils literal">Myriad</tt>, transforming each and every module of that layer (and of at least some modules of upper layers)</li>
</ul>
<p>So the purpose of this parse transform is to <strong>convert ASTs that are Myriad-compliant into ASTs that are directly Erlang compliant</strong>.</p>
<p id="table-transformations">For that, following changes are operated:</p>
<ul class="simple">
<li>in type specifications, the Myriad-specific <tt class="docutils literal">void/0</tt>, <tt class="docutils literal">maybe/1</tt> types are adequately translated:</li>
</ul>
<blockquote>
<ul class="simple">
<li><tt class="docutils literal">void()</tt> becomes <tt class="docutils literal">basic_utils:void()</tt>, a type alias of <tt class="docutils literal">any()</tt>, made to denote returned terms that are not expected to be used by the caller (as if that function's only purpose was its side-effects)</li>
<li><tt class="docutils literal">maybe(T)</tt> becomes the type union <tt class="docutils literal"><span class="pre">'undefined'|T</span></tt></li>
</ul>
</blockquote>
<ul class="simple">
<li>both in type specifications and actual code, <tt class="docutils literal">table/2</tt>, the Myriad-specific associative table pseudo-type, is translated into an actual <a class="reference internal" href="#table-type">table type</a>:</li>
</ul>
<blockquote>
<ul class="simple">
<li>by default, <tt class="docutils literal">map_hashtable</tt> (the generally most efficient one)</li>
<li>unless it is overridden on a per-module basis with the <tt class="docutils literal">table_type</tt> define, like in: <tt class="docutils literal"><span class="pre">-table_type(list_table).</span></tt></li>
</ul>
</blockquote>
<ul class="simple">
<li>the <tt class="docutils literal">cond_utils</tt> services will drive conditional code injection</li>
</ul>
<p>More generally, Myriad offers the support to traverse <em>any</em> AST (the whole Erlang grammar is supported, in its abstract form) and to <strong>transform</strong> it (ex: an expression being removed, transformed or replaced by other expressions), with the ability for the user to define his own type/call replacement mappings, or more general transformation functions to be triggered when specified elements are found in the AST (ex: remote calls with relevant MFA).</p>
<p>The traversal may be done in a stateful manner, i.e. any user-defined transformation will be able to access (read/write) any state of its own in the course of the traversal.</p>
<p>As a result, a single pass through the input AST may be done, in which any kind of transformations may be applied, resulting in another (Erlang-compliant) AST being output and afterwards compiled.</p>
<p></p>
</div>
<div class="section" id="management-of-units">
<span id="units"></span><h3><a class="toc-backref" href="#id52">Management of Units</a></h3>
<div class="section" id="motivation">
<h4><a class="toc-backref" href="#id53">Motivation</a></h4>
<p>A value of a given type (ex: a float) can actually correspond to quantities as different as meters and kilowatts per hour.</p>
<p>Therefore <strong>units shall preferably be specified alongside with values being processed</strong>, and a language to express, check and convert these units must be retained. Of course units are of interest as other metadata are - such as accuracy, semantics, etc.</p>
</div>
<div class="section" id="available-support">
<h4><a class="toc-backref" href="#id54">Available Support</a></h4>
<p>The <tt class="docutils literal">Myriad</tt> layer provides such a service, in a very basic, ad hoc form (which is useful to introduce &quot;special&quot; non-physical, non-standard units, such as <tt class="docutils literal">euro/year</tt>), meant to be enriched over time.</p>
</div>
<div class="section" id="specifying-units">
<h4><a class="toc-backref" href="#id55">Specifying Units</a></h4>
<div class="section" id="aliases">
<h5><a class="toc-backref" href="#id56">Aliases</a></h5>
<p>For convenience, <em>aliases</em> of units can be defined, i.e. alternate names for a given canonical unit. For example the Hertz unit (<tt class="docutils literal">Hz</tt>) is an alias of the <tt class="docutils literal"><span class="pre">s^-1</span></tt> (per-second) canonical unit.</p>
</div>
<div class="section" id="built-in-units">
<h5><a class="toc-backref" href="#id57">Built-in Units</a></h5>
<p>So one may use the following <strong>built-in units</strong>, whose symbol <a class="footnote-reference" href="#id18" id="id16">[6]</a> is specified here between brackets, like in <tt class="docutils literal">&quot;[N.m]&quot;</tt> (an alternate notation is to prefix a unit with <tt class="docutils literal">U:</tt>, like in <tt class="docutils literal">&quot;U: N.m&quot;</tt>):</p>
<ul class="simple">
<li>the seven <a class="reference external" href="https://en.wikipedia.org/wiki/SI_base_unit">SI base units</a>, namely:</li>
</ul>
<blockquote>
<ul class="simple">
<li>meter, for length [<tt class="docutils literal">m</tt>]</li>
<li>gram, for mass [<tt class="docutils literal">g</tt>] <a class="footnote-reference" href="#id19" id="id17">[7]</a> (note: this is a footnote, not an exponent!)</li>
<li>second, for time [<tt class="docutils literal">s</tt>]</li>
<li>ampere, for electric current [<tt class="docutils literal">A</tt>]</li>
<li>kelvin, for thermodynamic temperature [<tt class="docutils literal">K</tt>]</li>
<li>mole, for the amount of substance [<tt class="docutils literal">mol</tt>]</li>
<li>candela, for luminous intensity [<tt class="docutils literal">cd</tt>]</li>
</ul>
</blockquote>
<ul class="simple">
<li>the usual <a class="reference external" href="https://en.wikipedia.org/wiki/SI_derived_unit">derived units</a>, notably:</li>
</ul>
<blockquote>
<ul class="simple">
<li>hertz, for frequency [<tt class="docutils literal">Hz</tt>]</li>
<li>degree, for degree of arc [<tt class="docutils literal">°</tt>] (not supported yet)</li>
<li>radian, for angle [<tt class="docutils literal">rad</tt>] (not supported yet)</li>
<li>steradian, for solid angle [<tt class="docutils literal">sr</tt>] (not supported yet)</li>
<li>newton, for force, weight [<tt class="docutils literal">N</tt>]</li>
<li>pascal, for pressure, stress [<tt class="docutils literal">Pa</tt>]</li>
<li>joule, for energy, work, heat [<tt class="docutils literal">J</tt>]</li>
<li>watt, for power, radiant flux [<tt class="docutils literal">W</tt>]</li>
<li>coulomb, for electric charge, quantity of electricity [<tt class="docutils literal">C</tt>]</li>
<li>volt, for voltage, electrical potential difference, electromotive force [<tt class="docutils literal">V</tt>]</li>
<li>farad, for electrical capacitance [<tt class="docutils literal">F</tt>]</li>
<li>ohm, for electrical resistance, impedance, reactance [<tt class="docutils literal">Ohm</tt>]</li>
<li>siemens, for electrical conductance [<tt class="docutils literal">S</tt>]</li>
<li>weber, for magnetic flux [<tt class="docutils literal">Wb</tt>]</li>
<li>tesla, for magnetic field strength, magnetic flux density [<tt class="docutils literal">T</tt>]</li>
<li>henry, for inductance [<tt class="docutils literal">H</tt>]</li>
<li>lumen, for luminous flux [<tt class="docutils literal">lm</tt>]</li>
<li>lux, for illuminance [<tt class="docutils literal">lx</tt>]</li>
<li>becquerel, for radioactive decays per unit time [<tt class="docutils literal">Bq</tt>]</li>
<li>gray, for absorbed dose of ionizing radiation [<tt class="docutils literal">Gy</tt>]</li>
<li>sievert, for equivalent dose of ionizing radiation [<tt class="docutils literal">Sv</tt>]</li>
<li>katal, for catalytic activity [<tt class="docutils literal">kat</tt>]</li>
</ul>
</blockquote>
<ul class="simple">
<li>the units <strong>widely used</strong> in conjunction with SI units (note that they may not respect the principle of being a product of integer powers of one or more of the base units):</li>
</ul>
<blockquote>
<ul class="simple">
<li>litre, for 10<sup>-3</sup>m<sup>3</sup>volumes [<tt class="docutils literal">L</tt>]</li>
<li>tonne, for 1,000 kilogram masses [<tt class="docutils literal">t</tt>]</li>
<li>electronvolt, for 1.602176565(35).10-19 joule energies  [<tt class="docutils literal">eV</tt>]</li>
<li>minute, for 60-second durations [<tt class="docutils literal">min</tt>]</li>
<li>hour, for 60-minute durations [<tt class="docutils literal">h</tt>]</li>
<li>day, for 24-hour durations [<tt class="docutils literal">day</tt>]</li>
<li>week, for 7-day durations [<tt class="docutils literal">week</tt>]</li>
</ul>
</blockquote>
<ul class="simple">
<li>the <strong>special</strong> units (they generally cannot map directly to any SI unit, yet can be handled separately), designating:</li>
</ul>
<blockquote>
<ul class="simple">
<li>month [<tt class="docutils literal">month</tt>] (correspondence to base time units unspecified, as this duration is not constant; ex: a month can be 29, 30 or 31 days)</li>
<li>year [<tt class="docutils literal">year</tt>] (correspondence to base time units unspecified, as this duration is not constant; ex: a year can be 365, 366 or 365.25 days, etc.)</li>
<li>degree Celsius, for temperature relative to 273.15 K [<tt class="docutils literal">°C</tt>] (see note below)</li>
<li>dimension-less quantities (ex: an index) [<tt class="docutils literal">dimensionless</tt>] (most probably clearer than <tt class="docutils literal">m/m</tt>)</li>
<li>a count, i.e. a dimensionless number, generally a positive integer [<tt class="docutils literal">count</tt>] (ex: <tt class="docutils literal">14</tt>), considered as an alias of <tt class="docutils literal">dimensionless</tt></li>
<li>a ratio, i.e. a dimensionless floating-point value, generally displayed as a percentage [<tt class="docutils literal">ratio</tt>] (ex: <tt class="docutils literal"><span class="pre">-12.9%</span></tt>); another alias of <tt class="docutils literal">dimensionless</tt></li>
<li>currencies, either [<tt class="docutils literal">$</tt>] (US Dollar) or [<tt class="docutils literal">euros</tt>] (Euro), whose exchange rates of course vary</li>
<li>values whose unit has not been specified [<tt class="docutils literal">unspecified_unit</tt>]</li>
</ul>
</blockquote>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Metric_prefix">metric prefixes</a> thereof, i.e. multiples and sub-multiples of the units previously mentioned; currently the supported prefixes are:</li>
</ul>
<blockquote>
<ul class="simple">
<li>yotta, i.e. 10<sup>24</sup> [<tt class="docutils literal">Y</tt>]</li>
<li>zetta, i.e. 10<sup>21</sup> [<tt class="docutils literal">Z</tt>]</li>
<li>exa, i.e. 10<sup>18</sup> [<tt class="docutils literal">E</tt>]</li>
<li>peta, i.e. 10<sup>15</sup> [<tt class="docutils literal">P</tt>]</li>
<li>tera, i.e. 10<sup>12</sup> [<tt class="docutils literal">T</tt>]</li>
<li>giga, i.e. 10<sup>9</sup> [<tt class="docutils literal">G</tt>]</li>
<li>mega, i.e. 10<sup>6</sup> [<tt class="docutils literal">M</tt>]</li>
<li>kilo, i.e. 10<sup>3</sup> [<tt class="docutils literal">k</tt>]</li>
<li>hecto, i.e. 10<sup>2</sup> [<tt class="docutils literal">h</tt>]</li>
<li>deca, i.e. 10 [<tt class="docutils literal">da</tt>]</li>
<li>deci, i.e. 10<sup>-1</sup> [<tt class="docutils literal">d</tt>]</li>
<li>centi, i.e. 10<sup>-2</sup> [<tt class="docutils literal">c</tt>]</li>
<li>milli, i.e. 10<sup>-3</sup> [<tt class="docutils literal">m</tt>]</li>
<li>micro, i.e. 10<sup>-6</sup> [<tt class="docutils literal">µ</tt>]</li>
<li>nano, i.e. 10<sup>-9</sup> [<tt class="docutils literal">n</tt>]</li>
<li>pico, i.e. 10<sup>-12</sup> [<tt class="docutils literal">p</tt>]</li>
<li>femto, i.e. 10<sup>-15</sup> [<tt class="docutils literal">f</tt>]</li>
<li>atto, i.e. 10<sup>-18</sup> [<tt class="docutils literal">a</tt>]</li>
<li>zepto, i.e. 10<sup>-21</sup> [<tt class="docutils literal">z</tt>]</li>
<li>yocto, i.e. 10<sup>-24</sup> [<tt class="docutils literal">y</tt>]</li>
</ul>
<table class="docutils footnote" frame="void" id="id18" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[6]</a></td><td>To avoid requesting the user to type specific Unicode characters, we transliterated some of the symbols. For example, instead of using the capital Omega letter, we used <tt class="docutils literal">Ohm</tt>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id19" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id17">[7]</a></td><td>We preferred here deviating a bit from the SI system, by using this non-prefixed unit (the <em>gram</em>) instead of the SI standard one, which happens to be the <em>kilogram</em>.</td></tr>
</tbody>
</table>
</blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>There is a problem with temperatures, as they can be expressed at least in kelvins or degrees Celsius, whereas the two corresponding scales do not match, since there is an offset:</p>
<blockquote>
[K] = [°C] + 273.15</blockquote>
<p>As a result, unit conversions would require updating as well the corresponding value, and, more generally, they should be treated as fully distinct units (ex: <tt class="docutils literal"><span class="pre">kW/°C</span></tt> cannot be automatically converted in terms of SI base units, i.e. using <tt class="docutils literal">K</tt>).</p>
<p>This is why we &quot;degraded&quot; Celsius degrees, from a derived unit to a special one.</p>
<p>The same applies to the Fahrenheit unit (a likely addition), as:</p>
<blockquote class="last">
[°C] = 5/9.([°F]-32)</blockquote>
</div>
</div>
<div class="section" id="composing-one-s-units">
<h5><a class="toc-backref" href="#id58">Composing One's Units</a></h5>
<p>So an actual unit can be composed from the aforementioned built-in units (be they base, derived, widely used, special units; prefixed or not) <a class="footnote-reference" href="#id21" id="id20">[8]</a>, using two built-in operators, which are <tt class="docutils literal">&quot;.&quot;</tt> (multiply, represented by the dot character - not <tt class="docutils literal">&quot;*&quot;</tt>) and <tt class="docutils literal">&quot;/&quot;</tt> (divide, represented by the forward slash character).</p>
<table class="docutils footnote" frame="void" id="id21" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id20">[8]</a></td><td>In the future, defining an actual unit from other actual units might be contemplated.</td></tr>
</tbody>
</table>
<p>The resulting type shall be specified as a string, containing a series of built-in units (potentially prefixed) alternating with built-in operators, like in: <tt class="docutils literal">&quot;kW.s/m&quot;</tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>As a result, <tt class="docutils literal">&quot;kWh&quot;</tt> is not a valid unit: it should be denoted as <tt class="docutils literal">&quot;kW.h&quot;</tt>.</p>
<p class="last">Similarly, <tt class="docutils literal"><span class="pre">&quot;W/(m.k)&quot;</span></tt> is not valid, since parentheses are currently not supported: <tt class="docutils literal">&quot;W/m/k&quot;</tt> may be used instead.</p>
</div>
<p>Finally, exponents can be used as a shorthand for both operators (ex: <tt class="docutils literal"><span class="pre">kg.m^2.s^-1</span></tt>, instead of <tt class="docutils literal">kg.m.m/s</tt>). They should be specified explicitly, thanks to the caret character (<tt class="docutils literal">&quot;^&quot;</tt>); for example <tt class="docutils literal">&quot;m^2/s&quot;</tt>, not <tt class="docutils literal">&quot;m²/s&quot;</tt>.</p>
<p>If deemed both safe and useful, we may consider in the future performing:</p>
<ul class="simple">
<li>symbolic unit checking (i.e. determining that a derived unit such as <tt class="docutils literal">N.s</tt> (newton.second) is actually, in canonical SI units, <tt class="docutils literal"><span class="pre">m^2.kg.s^-1</span></tt>), and thus that values of these two types can safely be used indifferently in computations</li>
<li>automatic value conversions (ex: converting <tt class="docutils literal">km/hour</tt> into <tt class="docutils literal">m/s</tt>), provided that the overall computational precision is not significantly deteriorated</li>
</ul>
<p>The corresponding mechanisms (type information, conversion functions, unit checking and transformation, etc.) are defined in <tt class="docutils literal">unit_utils.erl</tt> and tested in <tt class="docutils literal">unit_utils_test.erl</tt>,  in the <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/utils</span></tt> directory.</p>
</div>
<div class="section" id="checking-units">
<h5><a class="toc-backref" href="#id59">Checking Units</a></h5>
<p>A typical example:</p>
<pre class="code erlang literal-block">
<span class="mi">1</span><span class="o">&gt;</span> <span class="nv">MyInputValue</span><span class="o">=</span><span class="s">&quot;-24 mS.m^-1&quot;</span><span class="p">.</span>
<span class="mi">2</span><span class="o">&gt;</span> <span class="p">{</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Unit</span><span class="p">}</span><span class="o">=</span><span class="nn">unit_utils</span><span class="p">:</span><span class="nf">parse_value_with_unit</span><span class="p">(</span><span class="nv">MyInputValue</span><span class="p">).</span>
<span class="mi">3</span><span class="o">&gt;</span> <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Corresponding value: </span><span class="si">~f</span><span class="s">.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="nv">Value</span> <span class="p">]</span> <span class="p">).</span>
<span class="nv">Corresponding</span> <span class="nn">value</span><span class="p">:</span> <span class="o">-</span><span class="mi">24</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span>
<span class="mi">4</span><span class="o">&gt;</span> <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Corresponding unit: </span><span class="si">~s</span><span class="s">.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span>
   <span class="p">[</span><span class="nn">unit_utils</span><span class="p">:</span><span class="nf">unit_to_string</span><span class="p">(</span><span class="nv">Unit</span><span class="p">)]).</span>
<span class="s">&quot;s^3.A^2.g^-1.m^-3, of order -6&quot;</span>
<span class="mi">5</span><span class="o">&gt;</span> <span class="nn">unit_utils</span><span class="p">:</span><span class="nf">value_with_unit_to_string</span><span class="p">(</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Unit</span><span class="p">).</span>
<span class="s">&quot;-2.4e-5 s^3.A^2.g^-1.m^-3&quot;</span>
</pre>
</div>
</div>
<div class="section" id="possible-improvements-regarding-dimensional-analysis">
<h4><a class="toc-backref" href="#id60">Possible Improvements Regarding Dimensional Analysis</a></h4>
<p>Some programming languages provide systems to manage dimensional information (ex: for physical quantities), generally through add-ons or libraries (rarely as a built-in feature).</p>
<p>A first level of support is to provide, like here, an API to manage units. Other levels can be:</p>
<ol class="arabic simple">
<li>to integrate unit management directly, seamlessly in language expressions, as if it was built-in (as opposed to having to use explicitly a third-party API for that); for example at least half a dozen different libraries provide that in Python</li>
<li>to be able to define &quot;polymorphic units and functions&quot;, for example to declare in general that a speed is a distance divided by a duration, regardless of the possible units used for that</li>
<li>to perfom <em>static</em> dimensional analysis, instead of checking units at runtime</li>
</ol>
<p>The two latter use cases can for example be at least partially covered by Haskell libraries.</p>
<p></p>
</div>
</div>
<div class="section" id="sql-support">
<h3><a class="toc-backref" href="#id61">SQL support</a></h3>
<div class="section" id="about-sql">
<h4><a class="toc-backref" href="#id62">About SQL</a></h4>
<p>Some amount of <a class="reference external" href="https://en.wikipedia.org/wiki/SQL">SQL</a> (<em>Structured Query Language</em>) support for relational database operations is provided by the <tt class="docutils literal">Myriad</tt> layer.</p>
<p>As this support relies on an optional prerequisite, this service is disabled by default.</p>
</div>
<div class="section" id="database-back-end">
<h4><a class="toc-backref" href="#id63">Database Back-end</a></h4>
<p>To perform SQL operations, a corresponding software solution must be available.</p>
<p>The SQL back-end chosen here is the <a class="reference external" href="https://www.sqlite.org/about.html">SQLite 3</a> library. It provides a self-contained, serverless, zero-configuration, transactional SQL database. It is an embedded SQL database engine, as opposed to server-based ones, like <a class="reference external" href="https://en.wikipedia.org/wiki/PostgreSQL">PostgreSQL</a> or <a class="reference external" href="https://en.wikipedia.org/wiki/MariaDB">MariaDB</a>.</p>
<p>It can be installed on Debian thanks to the <tt class="docutils literal">sqlite3</tt> and <tt class="docutils literal"><span class="pre">sqlite3-dev</span></tt> packages, <tt class="docutils literal">sqlite</tt> on Arch Linux..</p>
<p>We require version 3.6.1 or higher (preferably: latest stable one). It can be checked thanks to <tt class="docutils literal">sqlite3 <span class="pre">--version</span></tt>.</p>
<p>Various related tools are very convenient in order to interact with a SQLite database, including <tt class="docutils literal">sqlitebrowser</tt> and <tt class="docutils literal">sqliteman</tt>.</p>
<p>On Arch Linux, one can thus use: <tt class="docutils literal">pacman <span class="pre">-Sy</span> sqlite sqlitebrowser sqliteman</tt>.</p>
<p>Testing the back-end:</p>
<pre class="code bash literal-block">
$ sqlite3 my_test
</pre>
<pre class="code sql literal-block">
<span class="n">SQLite</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">13</span><span class="p">.</span><span class="mi">0</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">18</span> <span class="mi">10</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">30</span>
<span class="n">Enter</span> <span class="ss">&quot;.help&quot;</span> <span class="k">for</span> <span class="k">usage</span> <span class="n">hints</span><span class="p">.</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">tblone</span><span class="p">(</span><span class="n">one</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">two</span> <span class="nb">smallint</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">tblone</span> <span class="k">values</span><span class="p">(</span><span class="s1">'helloworld'</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">tblone</span> <span class="k">values</span><span class="p">(</span><span class="s1">'my_myriad'</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tblone</span><span class="p">;</span>
<span class="n">helloworld</span><span class="o">|</span><span class="mi">20</span>
<span class="n">my_myriad</span><span class="o">|</span><span class="mi">30</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="n">quit</span>
</pre>
<p>A file <tt class="docutils literal">my_test</tt>, identified as <tt class="docutils literal">SQLite 3.x database</tt>, must have been created, and can be safely removed.</p>
</div>
<div class="section" id="erlang-sql-binding">
<h4><a class="toc-backref" href="#id64">Erlang SQL Binding</a></h4>
<p>This database system is directly accessed thanks to an Erlang binding.</p>
<p>Two of them have been identified as good candidates:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/alexeyr/erlang-sqlite3">erlang-sqlite3</a>: seems popular, with many contributors and users, actively maintained, based on a <tt class="docutils literal">gen_server</tt> interacting with a C-node, involving only a few source files</li>
<li><a class="reference external" href="https://github.com/mmzeeman/esqlite">esqlite</a>: based on a NIF, so more able to jeopardize the stability of the VM, yet potentially more efficient</li>
</ul>
<p>Both are free software.</p>
<p>We finally preferred <tt class="docutils literal"><span class="pre">erlang-sqlite3</span></tt>.</p>
<p>By default we consider that this back-end has been installed in <tt class="docutils literal"><span class="pre">~/Software/erlang-sqlite3</span></tt>. The <tt class="docutils literal">SQLITE3_BASE</tt> variable in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/GNUmakevars.inc</span></tt> can be set to match any other install path.</p>
<p>Recommended installation process:</p>
<pre class="code bash literal-block">
$ mkdir ~/Software
$ <span class="nb">cd</span> ~/Software
$ git clone https://github.com/alexeyr/erlang-sqlite3.git
Cloning into <span class="s1">'erlang-sqlite3'</span>...
remote: Counting objects: <span class="m">1786</span>, <span class="k">done</span>.
remote: Total <span class="m">1786</span> <span class="o">(</span>delta <span class="m">0</span><span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta <span class="m">0</span><span class="o">)</span>, pack-reused <span class="m">1786</span>
Receiving objects: <span class="m">100</span>% <span class="o">(</span><span class="m">1786</span>/1786<span class="o">)</span>, <span class="m">3</span>.24 MiB <span class="p">|</span> <span class="m">570</span>.00 KiB/s, <span class="k">done</span>.
Resolving deltas: <span class="m">100</span>% <span class="o">(</span><span class="m">865</span>/865<span class="o">)</span>, <span class="k">done</span>.
Checking connectivity... <span class="k">done</span>.
$ <span class="nb">cd</span> erlang-sqlite3/
$ make
rm -rf deps ebin priv/*.so doc/* .eunit/* c_src/*.o config.tmp
rm -f config.tmp
<span class="nb">echo</span> <span class="s2">&quot;normal&quot;</span> &gt; config.tmp
./rebar get-deps <span class="nv">compile</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>get-deps<span class="o">)</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>compile<span class="o">)</span>
Compiled src/sqlite3_lib.erl
Compiled src/sqlite3.erl
Compiling c_src/sqlite3_drv.c
<span class="o">[</span>...<span class="o">]</span>
</pre>
<p>Testing the binding:</p>
<pre class="code bash literal-block">
make <span class="nb">test</span>
./rebar get-deps compile <span class="nv">eunit</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>get-deps<span class="o">)</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>compile<span class="o">)</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>eunit<span class="o">)</span>
Compiled src/sqlite3.erl
Compiled src/sqlite3_lib.erl
Compiled test/sqlite3_test.erl
<span class="o">========================</span> <span class="nv">EUnit</span> <span class="o">========================</span>
module <span class="s1">'sqlite3_test'</span>
  sqlite3_test: all_test_ <span class="o">(</span>basic_functionality<span class="o">)</span>...<span class="o">[</span><span class="m">0</span>.002 s<span class="o">]</span> ok
  sqlite3_test: all_test_ <span class="o">(</span>table_info<span class="o">)</span>...ok
  <span class="o">[</span>...<span class="o">]</span>
  sqlite3_lib: delete_sql_test...ok
  sqlite3_lib: drop_table_sql_test...ok
  <span class="o">[</span><span class="k">done</span> in <span class="m">0</span>.024 s<span class="o">]</span>
  module <span class="s1">'sqlite3'</span>
<span class="o">=======================================================</span>
All <span class="m">30</span> tests passed.
Cover analysis: ~/Software/erlang-sqlite3/.eunit/index.html
</pre>
<p>Pretty reassuring.</p>
</div>
<div class="section" id="sql-support-provided-by-the-myriad-layer">
<h4><a class="toc-backref" href="#id65">SQL Support Provided By the <em>Myriad</em> Layer</a></h4>
<p>To enable this support, once the corresponding back-end (see <a class="reference internal" href="#database-back-end">Database Back-end</a>) and binding (see <a href="#id74"><span class="problematic" id="id75">`Erlang Binding`_</span></a>) have been installed, the <tt class="docutils literal">USE_SQLITE</tt> variable should be set to <tt class="docutils literal">true</tt> in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/GNUmakevars.inc</span></tt> and <tt class="docutils literal">Myriad</tt> shall be rebuilt.</p>
<p>Then the corresponding implementation (<tt class="docutils literal">sql_support.erl</tt>) and test (<tt class="docutils literal">sql_support_test.erl</tt>), both in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/src/data-management</span></tt>, will be built (use <tt class="docutils literal">make clean all</tt> from the root of <tt class="docutils literal">Myriad</tt>) and able to be run (execute <tt class="docutils literal">make sql_support_run</tt> for that).</p>
<p>Testing it:</p>
<pre class="code bash literal-block">
$ <span class="nb">cd</span> Ceylan-Myriad/src/data-management
$ make sql_support_run
       Compiling module sql_support.erl
       Compiling module sql_support_test.erl
       Running unitary <span class="nb">test</span> sql_support_run
 <span class="o">[</span>...<span class="o">]</span>
 --&gt; Testing module sql_support_test.
 Starting SQL support <span class="o">(</span>based on SQLite3<span class="o">)</span>.
 <span class="o">[</span>...<span class="o">]</span>
 Closing database.
 Stopping SQL support.
 --&gt; Successful end of test.
 <span class="o">(</span><span class="nb">test</span> finished, interpreter halted<span class="o">)</span>
</pre>
<p>Looks good.</p>
</div>
<div class="section" id="sql-related-troubleshooting">
<h4><a class="toc-backref" href="#id66">SQL-related Troubleshooting</a></h4>
<div class="section" id="compiling-module-sql-support-erl-can-t-find-include-file-sqlite3-hrl">
<h5><a class="toc-backref" href="#id67">Compiling module sql_support.erl : can't find include file &quot;sqlite3.hrl&quot;</a></h5>
<ul class="simple">
<li><tt class="docutils literal">USE_SQLITE</tt> not set to <tt class="docutils literal">true</tt> in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/GNUmakevars.inc</span></tt></li>
<li><tt class="docutils literal"><span class="pre">erlang-sqlite3</span></tt> back-end not correctly installed (ex: <tt class="docutils literal">SQLITE3_BASE</tt> not pointing to a right path in <tt class="docutils literal"><span class="pre">Ceylan-Myriad/GNUmakevars.inc</span></tt>)</li>
</ul>
<p></p>
</div>
</div>
</div>
<div class="section" id="myriad-gotchas">
<h3><a class="toc-backref" href="#id68"><tt class="docutils literal">Myriad</tt> Gotchas</a></h3>
<div class="section" id="header-dependencies">
<h4><a class="toc-backref" href="#id69">Header dependencies</a></h4>
<p>Only a very basic dependency between header files (<tt class="docutils literal">*.hrl</tt>) and implementation files (<tt class="docutils literal">*.erl</tt>) is managed.</p>
<p>As expected, if <tt class="docutils literal">X.hrl</tt> changed, <tt class="docutils literal">X.beam</tt> will be recompiled whether or not <tt class="docutils literal">X.erl</tt> changed. However, any <tt class="docutils literal">Y.erl</tt> that would include <tt class="docutils literal">X.hrl</tt> would not be automatically recompiled.</p>
<p>Typically, when in doubt after having modified a record in a header file, just run <tt class="docutils literal">make rebuild</tt> from the root of that layer (build is fast anyway, as quite parallel).</p>
</div>
<div class="section" id="about-the-table-module">
<h4><a class="toc-backref" href="#id70">About the <tt class="docutils literal">table</tt> module</a></h4>
<p>This is a pseudo module, which is not meant to exist as such (no <tt class="docutils literal">table.erl</tt>, no <tt class="docutils literal">table.beam</tt>).</p>
<p>The <tt class="docutils literal">Myriad</tt> parse transform replaces references to the <tt class="docutils literal">table</tt> module by references to the <tt class="docutils literal">map_hashtable</tt> module. See <a class="reference internal" href="#table-transformations">table transformations</a> for more information.</p>
<p></p>
</div>
</div>
<div class="section" id="support-for-myriad">
<span id="support"></span><h3><a class="toc-backref" href="#id71">Support for <tt class="docutils literal">Myriad</tt></a></h3>
<p>So you respected the <a class="reference internal" href="#prerequisite">prerequisite</a> and <a class="reference internal" href="#build">build</a> sections, and something went wrong? Generally we made sure that any detected error is blocking and loudly reported, with as much context as possible.</p>
<p>The simpler solution is then to <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/issues">create a relevant issue</a>.</p>
<p>For all other needs, please drop an email to the address listed on top of document. We do our best to answer on a timely basis.</p>
<p>Finally, provided that they meet licensing terms, scope and quality standards, contributions of all sorts are vey welcome, be them porting efforts, increased test coverage, functional enrichments, documentation improvements, code enhancements, etc. See the next section for additional guidelines.</p>
<p></p>
</div>
</div>
<div class="section" id="please-react">
<h2><a class="toc-backref" href="#id72">Please React!</a></h2>
<p>If you have information more detailed or more recent than those presented in this document, if you noticed errors, neglects or points insufficiently discussed, drop us a line! (for that, follow the <a class="reference internal" href="#support">Support</a> guidelines).</p>
</div>
<div class="section" id="contributions-ending-word">
<h2><a class="toc-backref" href="#id73">Contributions &amp; Ending Word</a></h2>
<p>Each time that you need a basic service that:</p>
<ul class="simple">
<li>seems neither provided by the Erlang <a class="reference external" href="http://erlang.org/doc/man_index.html">built-in modules</a> nor by this <tt class="docutils literal">Myriad</tt> layer</li>
<li>is generic-enough, simple and requires no special prerequisite</li>
</ul>
<p>please either enrich our <tt class="docutils literal">*_utils.erl</tt> helpers, or add new general services!</p>
<p>In such a case, we would prefer that, in contributed code:</p>
<ul class="simple">
<li>Myriad code style is, as much as possible, respected (regarding naming, spacing, code/comments/blank line ratios, etc.)</li>
<li>lines stop no later than their 80th character</li>
<li>whitespaces be removed (ex: one may use the <tt class="docutils literal">whitespace.el</tt> Emacs mode)</li>
</ul>
<p>Thanks in advance, and have fun with Myriad!</p>
<div class="figure align-center">
<img alt="Myriad logo" src="myriad-title.png" style="width: 50%;" />
</div>
<p><span class="raw-html"><a name="myriad_bottom"></a></span></p>
</div>
</div>
<div class="system-messages section">
<h1>Docutils System Messages</h1>
<div class="system-message" id="id74">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">Ceylan-Myriad-Layer-sql-support-english.rst</tt>, line 128); <em><a href="#id75">backlink</a></em></p>
Unknown target name: &quot;erlang binding&quot;.</div>
</div>
</div>
</body>
</html>
